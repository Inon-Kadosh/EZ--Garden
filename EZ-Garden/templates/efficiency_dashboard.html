<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Efficiency Tracking</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(90deg, #7fd4bb, #b9e2a8, #7fd4bb);
            background-size: 300% 300%;
            animation: backgroundAnimation 10s ease infinite;
            color: #333;
            display: flex;
            flex-direction: column;
        }

        @keyframes backgroundAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            width: 90%;
            margin: 60px auto;
            background-color: #ffffff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            text-align: center;
            color: #2a2a2a;
        }

        label {
            font-size: 16px;
            margin-bottom: 5px;
            display: block;
            color: #2a2a2a;
        }

        select {
            width: 100%;
            padding: 10px;
            margin: 20px 0;
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        select:focus {
            outline: none;
            border-color: #7fd4bb;
            box-shadow: 0 0 5px rgba(127, 212, 187, 0.5);
        }

        #chart-container {
            width: 80%;
            margin: auto;
            display: none;
        }

        canvas {
            margin-top: 20px;
        }

        p {
            font-size: 16px;
            color: #333;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">EZ-Garden</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/graphs_select_date">Graphs</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/home_company_3">Back</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/home3">Plant List</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/map">Map</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/weather">Weather</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/data_for_kids">Kids</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/employee_management">Employee Management</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/issues">Issues</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <h1>Efficiency Tracking</h1>

        <!-- Metric Selection -->
        <label for="metric-select">Select a metric:</label>
        <select id="metric-select">
            <option value="">-- Select a metric --</option>
        </select>

        <!-- Chart Display Area -->
        <div id="chart-container">
            <canvas id="metric-chart"></canvas>
            <p id="metric-summary"></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let efficiencyData;

        // Load JSON data from the server
        async function loadEfficiencyData() {
            const response = await fetch('/get_efficiency_data');
            efficiencyData = await response.json();

            const metricSelect = document.getElementById('metric-select');
            efficiencyData.efficiency_data.forEach(metric => {
                const option = document.createElement('option');
                option.value = metric.id;
                option.textContent = metric.label;
                metricSelect.appendChild(option);
            });
        }

        const metricSelect = document.getElementById("metric-select");
        const chartContainer = document.getElementById("chart-container");
        const metricChartCanvas = document.getElementById("metric-chart");
        const metricSummary = document.getElementById("metric-summary");

        let chart;

        // Function to render the chart
        function renderChart(metric) {
            const metricData = efficiencyData.efficiency_data.find(item => item.id === metric);
            if (!metricData) return;

            // Clear existing chart (if any)
            if (chart) chart.destroy();

            // Create a new chart
            const ctx = metricChartCanvas.getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: metricData.months,
                    datasets: [{
                        label: metricData.label,
                        data: metricData.data,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true
                        }
                    }
                }
            });

            // Display summary below the chart
            metricSummary.textContent = metricData.summary;

            // Show chart area
            chartContainer.style.display = "block";
        }

        // Listener for metric selection change
        metricSelect.addEventListener("change", () => {
            const selectedMetric = metricSelect.value;
            if (selectedMetric) {
                renderChart(selectedMetric);
            } else {
                chartContainer.style.display = "none";
            }
        });

        // Load data on page load
        loadEfficiencyData();
    </script>
</body>
</html>
